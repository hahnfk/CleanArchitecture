<UserControl x:Class="CleanArchitecture.Presentation.Wpf.Views.TodosView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <DockPanel Margin="10">

        <!-- Toolbar -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Add" Width="100" Command="{Binding AddInlineRowCommand}"/>
        </StackPanel>

        <ListView ItemsSource="{Binding Items}">
            <ListView.View>
                <GridView>

                    <!-- Completed toggle (radio look) -->
                    <GridViewColumn Header="" Width="44">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox Style="{StaticResource Toggle.RadioLook}"
                                          IsChecked="{Binding IsCompleted, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <CheckBox.ToolTip>
                                        <TextBlock Text="Completed"/>
                                    </CheckBox.ToolTip>
                                </CheckBox>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Title: display vs editor -->
                    <GridViewColumn Header="Title" Width="360">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <!-- Display label -->
                                    <TextBlock x:Name="Display"
                                               Text="{Binding Title}"
                                               Style="{StaticResource TitleTextBlock}"
                                               VerticalAlignment="Center"/>

                                    <!-- Editor (collapsed by default) -->
                                    <TextBox x:Name="Editor"
                                             Text="{Binding EditableTitle, UpdateSourceTrigger=PropertyChanged}"
                                             MinWidth="180"
                                             VerticalAlignment="Center"
                                             Visibility="Collapsed"
                                             Loaded="TextBox_Loaded"/>
                                </Grid>

                                <!-- Switch visibility based on IsEditing -->
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                        <Setter TargetName="Display" Property="Visibility" Value="Collapsed"/>
                                        <Setter TargetName="Editor"  Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="False">
                                        <Setter TargetName="Display" Property="Visibility" Value="Visible"/>
                                        <Setter TargetName="Editor"  Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Actions -->
                    <GridViewColumn Header="Actions" Width="320">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="6,0">
                                    <!-- Normal mode -->
                                    <Button Content="Edit"
                                            Style="{StaticResource CellButton.EditVisibleWhenNormal}"
                                            Command="{Binding DataContext.StartEditCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />

                                    <Button Content="Delete"
                                            Style="{StaticResource CellButton.DeleteVisibleWhenNormal}"
                                            Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />

                                    <!-- Edit mode (existing item) -->
                                    <Button Content="Save"
                                            Style="{StaticResource CellButton.VisibleWhenEditing}"
                                            Command="{Binding DataContext.SaveEditCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />

                                    <Button Content="Cancel"
                                            Style="{StaticResource CellButton.VisibleWhenEditing}"
                                            Command="{Binding DataContext.CancelEditCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />

                                    <!-- New inline row -->
                                    <Button Content="Save New"
                                            Style="{StaticResource CellButton.VisibleWhenNew}"
                                            Command="{Binding DataContext.SaveNewCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />

                                    <Button Content="Cancel New"
                                            Style="{StaticResource CellButton.VisibleWhenNew}"
                                            Command="{Binding DataContext.CancelNewCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                </GridView>
            </ListView.View>
        </ListView>

    </DockPanel>
</UserControl>
